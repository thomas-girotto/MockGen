<#@ template language="C#" #>
<#@ assembly name="System.Core" #>
<#@ import namespace="System.Linq" #>
<#@ import namespace="System.Text" #>
<#@ import namespace="System.Collections.Generic" #>
<#@ import namespace="MockGen.Model" #>
using System;
using MockGen.Setup;
<# foreach (var ns in view.Namespaces) { #> 
using <#=ns#>;
<# } #>

namespace MockGen
{
    internal class <#=view.TypeToMock#>Mock : <#=view.Mock.TypeToMockOriginalName#>
    {
        private readonly <#=view.TypeToMock#>MethodsSetup methods;

<# foreach (var ctorParameters in view.CtorsParameters) { #>
        public <#=view.TypeToMock#>Mock(<#=ctorParameters.ConcatParametersDeclarationWith(view.TypeToMock + "MethodsSetup methods")#>)<#=string.Format(view.CallBaseCtorIfNeeded, ctorParameters.Names)#>
        {
            this.methods = methods;
        }
<# } #>

<# foreach (var property in view.Mock.Properties) { #>
<# if(property.HasGetter && property.HasSetter) { #>
        public <#=property.Type.Name#> <#=property.Name#>
        {
            get => methods.<#=property.Name#>Setup.ExecuteGetSetup();
            set => methods.<#=property.Name#>Setup.ExecuteSetSetup(value);
        }
<# } else if (property.HasGetter) { #>
        public <#=property.Type.Name#> <#=property.Name#> => methods.<#=property.Name#>Setup.ExecuteGetSetup();
<# } else { #>
        public <#=property.Type.Name#> <#=property.Name#>
        {
            set => methods.<#=property.Name#>Setup.ExecuteSetSetup(value);
        }
<# } #>

<# } #>
<# foreach (var method in view.Methods) { #>
<# if (method.ReturnType.TaskKind == TaskKind.Task) { #>
        public <#=method.AddOverrideKeywordIfNeeded#>Task<<#=method.ReturnType.Name#>> <#=method.Name#>(<#=method.Parameters.ParametersDeclarationWithOutParameters#>)
<# } else { #>
        public <#=method.AddOverrideKeywordIfNeeded#><#=method.ReturnType.Name#> <#=method.Name#>(<#=method.Parameters.ParametersDeclarationWithOutParameters#>)
<# } #>        
        {
<# if (method.Parameters.HasOutParameter) { #>
            <#=method.Parameters.OutParameterNames#> = methods.<#=method.UniqueName#>OutParameterSetup(<#=method.Parameters.Names#>); 
<# } #>
<# if (!method.ReturnsVoid) { #>
            return methods.<#=method.UniqueName#>Setup.ExecuteSetup(<#=method.Parameters.Names#>);
<# } else { #>
            methods.<#=method.UniqueName#>Setup.ExecuteSetup(<#=method.Parameters.Names#>);
<# } #>
        }

<# } #>
    }
}
